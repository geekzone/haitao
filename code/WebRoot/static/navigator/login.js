function ajax_filteruser(c){if(c.log.value!=""&&c.pwd.value!=""){$("#ajax-submit").prop({"disabled":true,"value":"正在登录……"}).removeClass("loginBtn").addClass("loginBtnDisabled");var b="";var a="";if(c.nickname){b=c.nickname.value;}if(c.email){a=c.email.value;}$.ajax({type:"GET",url:"/issupchar.php?log="+c.log.value+"&pwd="+c.pwd.value+"&nickname="+encodeURI(b)+"&email="+encodeURI(a)+"&havechecked="+c.havechecked.value,data:"",dataType:"json",success:function(d){var e=true;$("#username_notice").removeClass().html("");$("#nickname_notice").removeClass().html("");$("#mail_notice").removeClass().html("");$("#password_notice").removeClass().html("");$("#ajax_email").removeClass("redBorder");$("#ajax_nickname").removeClass("redBorder");if(d.supchar==1&&d.noemail!=1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError").html("昵称包含无效字符，请重新设置吧。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==1&&d.noemail==1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#span_email").html('<input type="text" name="email" id="ajax_email" class="inputData redBorder"  tabindex="101" />').parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError").html("昵称包含无效字符，请更换昵称并设置邮箱。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==4&&d.noemail!=1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError").html("昵称长度请限制在4~15个字符。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==4&&d.noemail==1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#span_email").html('<input type="text" name="email" id="ajax_email" class="inputData redBorder"  tabindex="101" />').parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError").html("昵称长度请限制在4~15个字符。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==7&&d.noemail!=1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError").html("昵称不可与用户名相同，请确认是否保留，确认后不可更改咯。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==7&&d.noemail==1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#span_email").html('<input type="text" name="email" id="ajax_email" class="inputData redBorder"  tabindex="101" />').parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError").html("昵称不可与用户名相同，请确认是否保留，确认后不可更改咯。您还未设置邮箱，请设置邮箱。").show();c.havechecked.value=1;e=false;}else{if(d.noemail==1){$("#span_email").html('<input type="text" name="email" id="ajax_email" class="inputData redBorder"  tabindex="101" />').parent().removeClass("lnn");$("#mail_notice").removeClass().addClass("layerError").html("请完善您的个人资料，设置您的邮箱。").show();c.havechecked.value=2;e=false;}}}}}}}var g="";if(d.supchar==6){g="请输入昵称。";e=false;}else{if(d.supchar==2){g="昵称只允许使用中英文、数字和下划线。";e=false;}else{if(d.supchar==3){g="昵称已被占用，请重新设置。";e=false;}else{if(d.supchar==5){g="昵称长度限制为4~15个字符，请重新设置。";e=false;}}}}var f="";if(d.noemail==6){f="邮箱不能为空，请输入邮箱地址。";e=false;}else{if(d.noemail==2){f="邮箱无效，请重新设置一个有效的邮件地址。";e=false;}else{if(d.noemail==3){f="邮箱已经被注册，请重新设置。";e=false;}}}if(g!=""){$("#nickname_notice").removeClass().addClass("layerError").html(g);$("#ajax_nickname").addClass("redBorder");}if(f!=""){$("#mail_notice").removeClass().addClass("layerError").html(f);$("#ajax_email").addClass("redBorder");}if(e){$.post("/wp-login.php",{"log":c.log.value,"pwd":c.pwd.value,"email":a,"nickname":b,"havechecked":c.havechecked.value,"testcookie":c.testcookie.value,"action":c.logintype.value,"rememberme":c.rememberme.value},function(h){if(h.state){window.location.reload();}else{$("#ajax-submit").prop({"disabled":false,"value":"登 录"}).removeClass("loginBtnDisabled").addClass("loginBtn");$("#"+h.notice_for+"_notice").removeClass().addClass("layerError").html(h.msg).show();}},"json");}else{$("#ajax-submit").prop({"disabled":false,"value":"登 录"}).removeClass("loginBtnDisabled").addClass("loginBtn");}}});}}function stoppropagation(a){if($.browser.msie){event.cancelBubble=true;}else{a.stopPropagation();a.preventDefault();}}function ajax_login(){var a="";a+='    <div class="layerAbs"></div>';a+='    <form class="layerBg"  id="ajaxLoginForm">';a+='    <div class="layerWrap">';a+='        <a href="#" class="layerClose">关闭</a>';a+='        <div class="layerHeader">';a+='            <span class="layerTitle">登录</span>';a+='            <div class="loginReg">没有账号？<a href="/register.php">快速注册</a></div>';a+='            <div class="clear"></div>';a+="        </div>";a+='        <div class="layerContent">';a+='            <div class="layerList">';a+='                <label for="userLogin">用户名：</label>';a+='                <input type="text" name="log" id="userLogin" class="inputData" tabindex="100"/>';a+='                <div class="clear"></div>';a+='                <span id="username_notice"></span>';a+="            </div>";a+='            <div class="layerList lnn">';a+='                <label for="email">邮箱：</label>';a+='                <span id="span_email"></span>';a+='                <div class="clear"></div>';a+='                <span id="mail_notice" ></span>';a+="            </div>";a+='            <div class="layerList lnn">';a+='                 <label for="nickname">昵称：</label>';a+='                 <span id="span_nickname"></span>';a+='                 <div class="clear"></div>';a+='                 <span id="nickname_notice"></span>';a+="            </div>";a+='            <div class="layerList">';a+='                <label for="userPass">密码：</label>';a+='                <input type="password" name="pwd" id="userPass" class="inputData" tabindex="101"/>';a+='                <div class="clear"></div>';a+='                <span id="password_notice"></span>';a+="            </div>";a+='        <div class="loginBotBox">';a+='            <div class="twoWeek">';a+='                <input name="rememberme" type="checkbox" id="rememberme" value="forever" tabindex="104"/>';a+='                <span class="alt_message">两周内自动登录</span>';a+="            </div>";a+='            <div class="forgetPwd"><a href="/wp-login.php?action=lostpassword" title=" 忘记密码">忘记密码？</a></div>';a+='            <div class="clear"></div>';a+="        </div>";a+='        <div class="loginBtnBox">';a+='            <input type="button" id="ajax-submit" name="ajax-submit" class="loginBtn" value="登&nbsp;&nbsp;录" onclick="ajax_filteruser(this.form);" tabindex="105"/>';a+='            <input type="hidden" name="havechecked" value="0"/>';a+='            <input type="hidden" name="testcookie" value="1"/>';a+='            <input type="hidden" name="logintype" value="ajaxlogin"/>';a+="        </div>";a+='        <div class="dataItemBot">       ';a+='            <a rel="nofollow" title="腾讯微博" href="'+smzdm_site_domain+'wp-content/plugins/clogin/login.php?go=tencent&amp;redirect_to=/">';a+='                <img src="'+smzdm_site_domain+'wp-content/plugins/clogin/images/btn_tencent.png" original="'+smzdm_site_domain+'wp-content/plugins/clogin/images/btn_tencent.png">';a+="            </a>";a+='            <a rel="nofollow" title="新浪微博" href="'+smzdm_site_domain+'wp-content/plugins/clogin/login.php?go=sina&amp;redirect_to=/">';a+='                <img src="'+smzdm_site_domain+'wp-content/plugins/clogin/images/btn_sina.png" original="'+smzdm_site_domain+'wp-content/plugins/clogin/images/btn_sina.png">';a+="            </a>";a+='            <a rel="nofollow" title="腾讯QQ" href="'+smzdm_site_domain+'wp-content/plugins/clogin/login.php?go=qzone&amp;redirect_to=/">';a+='                <img src="'+smzdm_site_domain+'wp-content/plugins/clogin/images/btn_qzone.png" original="'+smzdm_site_domain+'wp-content/plugins/clogin/images/btn_qzone.png">';a+="            </a>";a+='            <span class="wordTitle">您可以用合作网站帐号登录:</span>';a+="        </div>";a+="    </div>";a+="    </form>";if(!window._loginbox){window._loginbox=$('<div class="layerFixed"></div>');$(document.body).append(window._loginbox);window._loginbox.html(a);$(document).on("keydown",function(b){if(b.keyCode==13){stoppropagation(b);_fml=$("#ajaxLoginForm");ajax_filteruser(_fml[0]);}});}window._loginbox.show();$("#userLogin").addClass("inputClick").focus();jQuery("html, body").animate({scrollTop:0},0);$(".layerClose").off("click").on("click",function(){window._loginbox.hide();});$(".inputData").click(function(){$(this).addClass("inputClick");});$(".inputData").blur(function(){$(this).removeClass("inputClick");});}function filteruser(c){if(c.log.value!=""&&c.pwd.value!=""){$("#wp-submit").prop({"disabled":true,"value":"正在登录…"}).removeClass("loginBtn").addClass("loginBtnDisabled");var b="";var a="";if(c.nickname){b=c.nickname.value;}if(c.email){a=c.email.value;}$.ajax({type:"GET",url:"/issupchar.php?log="+c.log.value+"&pwd="+c.pwd.value+"&nickname="+encodeURI(b)+"&email="+encodeURI(a)+"&havechecked="+c.havechecked.value,data:"",dataType:"json",success:function(d){var e=true;$("#username_notice").removeClass().html("");$("#nickname_notice").removeClass().html("");$("#mail_notice").removeClass().html("");$("#password_notice").removeClass().html("");$("#ajax_email").removeClass("redBorder");$("#ajax_nickname").removeClass("redBorder");if(d.supchar==1&&d.noemail!=1){c.havechecked.value=1;e=false;$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData inputData2 redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError layerError2").html("昵称包含无效字符，请重新设置吧。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==1&&d.noemail==1){$("#span_email").html('<input type="text" name="email" id="ajax_email" class="inputData inputData2 redBorder"  tabindex="101" />').parent().removeClass("lnn");$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData inputData2 redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError layerError2").html("昵称包含无效字符，请更换昵称并设置邮箱。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==4&&d.noemail!=1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData inputData2 redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError layerError2").html("昵称长度请限制在4~15个字符。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==4&&d.noemail==1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData inputData2 redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#span_email").html('<input type="text" name="email" id="ajax_email" class="inputData inputData2 redBorder"  tabindex="101" />').parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError layerError2").html("昵称长度请限制在4~15个字符。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==7&&d.noemail!=1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData inputData2 redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError layerError2").html("昵称不可与用户名相同，请确认是否保留，确认后不可更改咯。").show();c.havechecked.value=1;e=false;}else{if(d.supchar==7&&d.noemail==1){$("#span_nickname").html('<input type="text" name="nickname" id="ajax_nickname" class="inputData inputData2 redBorder"  tabindex="101" value='+d.nickname+" />").parent().removeClass("lnn");$("#span_email").html('<input type="text" name="email" id="ajax_email" class="inputData inputData2 redBorder"  tabindex="101" />').parent().removeClass("lnn");$("#nickname_notice").removeClass().addClass("layerError layerError2").html("昵称不可与用户名相同，请确认是否保留，确认后不可更改咯。您还未设置邮箱，请设置邮箱。").show();c.havechecked.value=1;e=false;}else{if(d.noemail==1){$("#span_email").html('<input type="text" name="email" id="ajax_email" class="inputData inputData2 redBorder"  tabindex="101" />').parent().removeClass("lnn");$("#mail_notice").removeClass().addClass("layerError layerError2").html("请完善您的个人资料，设置您的邮箱。").show();c.havechecked.value=2;e=false;}}}}}}}var g="";if(d.supchar==6){g="您修改的昵称不能为空，需要再另选一个昵称。";e=false;}else{if(d.supchar==2){g="您修改的昵称还存在无效字符，需要再另选一个昵称。";e=false;}else{if(d.supchar==3){g="您修改的昵称已经被占用，请另选一个昵称。";e=false;}else{if(d.supchar==5){g="您修改的昵称要在4~15个字符之间，需要再另选一个昵称。";e=false;}}}}var f="";if(d.noemail==6){f="您的邮箱不能为空。";e=false;}else{if(d.noemail==2){f="请输入一个有效的电子邮件地址。";e=false;}else{if(d.noemail==3){f="该电子邮件地址已经被注册，请换一个。";e=false;}}}if(g!=""){$("#nickname_notice").removeClass().addClass("layerError ").html(g);$("#nickname").addClass("redBorder");}if(f!=""){$("#mail_notice").removeClass().addClass("layerError ").html(f);$("#email").addClass("redBorder");}if(e){c.submit();}else{$("#wp-submit").prop({"disabled":false,"value":"登录"}).removeClass("loginBtnDisabled").addClass("loginBtn");}}});}}$(document).ready(function(){$("#loginform").unbind("keydown");$("#loginform").keydown(function(a){if(a.keyCode==13){if($.browser.msie){event.cancelBubble=true;}else{a.stopPropagation();a.preventDefault();}_fml=$("#loginform");filteruser(_fml[0]);}});});function register_ready(){$("#registerform").bind("submit",function(){if($("#registertreaty").attr("checked")=="checked"){return true;}else{alert("请您先仔细阅读用户使用协议");return false;}});}function reload_img(a){window.onload=function(){document.getElementById("captcha_img").src=a;};}